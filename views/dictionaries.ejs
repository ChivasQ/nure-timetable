<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <title>–î–æ–≤—ñ–¥–Ω–∏–∫–∏ (–õ–∞–± 5)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">üìö –î–æ–≤—ñ–¥–Ω–∏–∫–∏</a>
            <div>
                <a href="/admin" class="btn btn-outline-light btn-sm">üìÖ –î–æ —Ä–æ–∑–∫–ª–∞–¥—É</a>
            </div>
        </div>
    </nav>

    <div class="container pb-5">
        
        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#teachers" type="button">üë®‚Äçüè´ –í–∏–∫–ª–∞–¥–∞—á—ñ</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#subjects" type="button">üìò –ü—Ä–µ–¥–º–µ—Ç–∏</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#classrooms" type="button">üö™ –ê—É–¥–∏—Ç–æ—Ä—ñ—ó</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#groups" type="button">üë• –ì—Ä—É–ø–∏</button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            
            <div class="tab-pane fade show active" id="teachers">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card p-3 shadow-sm">
                            <h5>–î–æ–¥–∞—Ç–∏ –≤–∏–∫–ª–∞–¥–∞—á–∞</h5>
                            <form action="/admin/dictionaries/add/teacher" method="POST">
                                <input name="full_name" class="form-control mb-2" placeholder="–ü–Ü–ë" required>
                                <button class="btn btn-primary w-100">–î–æ–¥–∞—Ç–∏</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white p-3">
                                <form action="/admin/dictionaries" method="GET" class="d-flex gap-2">
                                    <input type="text" name="teacher_search" class="form-control" 
                                           placeholder="üîç –ü–æ—à—É–∫ –∑–∞ –ø—Ä—ñ–∑–≤–∏—â–µ–º..." 
                                           value="<%= query.teacher_search || '' %>">
                                    <button class="btn btn-outline-primary" type="submit">–ó–Ω–∞–π—Ç–∏</button>
                                    <% if(query.teacher_search) { %>
                                        <a href="/admin/dictionaries" class="btn btn-outline-secondary" title="–°–∫–∏–Ω—É—Ç–∏ –ø–æ—à—É–∫">‚ùå</a>
                                    <% } %>
                                </form>
                            </div>

                            <ul class="list-group list-group-flush">
                                <% teachers.forEach(t => { %>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <%= t.full_name %>
                                        <div>
                                            <button class="btn btn-sm btn-warning" 
                                                onclick="openEditModal('teacher', '<%= t.id %>', '<%= t.full_name %>', '<%= t.short_name %>')">
                                                ‚úèÔ∏è
                                            </button>
                                            <form action="/admin/dictionaries/delete/teacher/<%= t.id %>" method="POST" class="d-inline" onsubmit="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')">
                                                <button class="btn btn-sm btn-danger">üóëÔ∏è</button>
                                            </form>
                                        </div>
                                    </li>
                                <% }) %>
                                <% if(teachers.length === 0) { %>
                                    <li class="list-group-item text-center text-muted py-4">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üïµÔ∏è‚Äç‚ôÇÔ∏è</li>
                                <% } %>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="subjects">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card p-3 shadow-sm">
                            <h5>–î–æ–¥–∞—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç</h5>
                            <form action="/admin/dictionaries/add/subject" method="POST">
                                <input name="full_name" class="form-control mb-2" placeholder="–ü–æ–≤–Ω–∞ –Ω–∞–∑–≤–∞" required>
                                <input name="short_name" class="form-control mb-2" placeholder="–°–∫–æ—Ä–æ—á–µ–Ω–æ">
                                <button class="btn btn-primary w-100">–î–æ–¥–∞—Ç–∏</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <ul class="list-group shadow-sm">
                            <% subjects.forEach(s => { %>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><%= s.full_name %> <small class="text-muted">(<%= s.short_name %>)</small></span>
                                    <div>
                                        <button class="btn btn-sm btn-warning" 
                                            onclick="openEditModal('subject', '<%= s.id %>', '<%= s.full_name %>', '<%= s.short_name %>')">‚úèÔ∏è</button>
                                        <form action="/admin/dictionaries/delete/subject/<%= s.id %>" method="POST" class="d-inline" onsubmit="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')">
                                            <button class="btn btn-sm btn-danger">üóëÔ∏è</button>
                                        </form>
                                    </div>
                                </li>
                            <% }) %>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="classrooms">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card p-3 mb-3 shadow-sm">
                            <h5>–î–æ–¥–∞—Ç–∏ –∞—É–¥–∏—Ç–æ—Ä—ñ—é</h5>
                            <form action="/admin/dictionaries/add/classroom" method="POST">
                                <input name="room_number" class="form-control mb-2" placeholder="–ù–æ–º–µ—Ä (–Ω–∞–ø—Ä. 305)" required>
                                <input name="building" class="form-control mb-2" placeholder="–ö–æ—Ä–ø—É—Å" required>
                                <input name="capacity" type="number" class="form-control mb-2" placeholder="–ú—ñ—Å—Ü—å (-1 –¥–ª—è DL)" required>
                                <button class="btn btn-primary w-100">–î–æ–¥–∞—Ç–∏</button>
                            </form>
                        </div>

                        <div class="card p-3 border-info shadow-sm bg-white">
                            <h6 class="text-info border-bottom pb-2 mb-3">üõ† –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Å–ø–∏—Å–∫—É</h6>
                            <form action="/admin/dictionaries" method="GET">
                                
                                <label class="form-label small text-muted mb-1">–î—ñ–∞–ø–∞–∑–æ–Ω –º—ñ—Å—Ç–∫–æ—Å—Ç—ñ</label>
                                <div class="input-group mb-3">
                                    <input type="number" name="room_min" class="form-control form-control-sm" placeholder="–í—ñ–¥" value="<%= query.room_min %>">
                                    <span class="input-group-text bg-light">-</span>
                                    <input type="number" name="room_max" class="form-control form-control-sm" placeholder="–î–æ" value="<%= query.room_max %>">
                                </div>

                                <label class="form-label small text-muted mb-1">–ö–æ—Ä–ø—É—Å</label>
                                <select name="room_building" class="form-select form-select-sm mb-3">
                                    <option value="">-- –í—Å—ñ –∫–æ—Ä–ø—É—Å–∏ --</option>
                                    <% if(typeof buildings !== 'undefined') { %>
                                        <% buildings.forEach(b => { %>
                                            <option value="<%= b %>" <%= query.room_building === b ? 'selected' : '' %>><%= b %></option>
                                        <% }) %>
                                    <% } %>
                                </select>

                                <div class="d-grid gap-2">
                                    <button class="btn btn-info btn-sm text-white">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä</button>
                                    <a href="/admin/dictionaries" class="btn btn-outline-secondary btn-sm">–°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ —Ñ—ñ–ª—å—Ç—Ä–∏</a>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="alert alert-secondary py-2 d-flex justify-content-between align-items-center">
                            <span>–ó–Ω–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å—ñ–≤: <strong><%= classrooms.length %></strong></span>
                        </div>
                        <ul class="list-group shadow-sm">
                            <% classrooms.forEach(c => { %>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>üö™ <strong><%= c.room_number %></strong> (<%= c.building %>) ‚Äî <span class="badge bg-light text-dark border"><%= c.capacity == -1 ? '‚àû' : c.capacity %> –º—ñ—Å—Ü—å</span></span>
                                    <div>
                                        <button class="btn btn-sm btn-warning" 
                                            onclick="openEditModal('classroom', '<%= c.id %>', '<%= c.room_number %>', '<%= c.building %>', '<%= c.capacity %>')">‚úèÔ∏è</button>
                                        <form action="/admin/dictionaries/delete/classroom/<%= c.id %>" method="POST" class="d-inline" onsubmit="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')">
                                            <button class="btn btn-sm btn-danger">üóëÔ∏è</button>
                                        </form>
                                    </div>
                                </li>
                            <% }) %>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="groups">
                 <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card p-3 shadow-sm">
                            <h5>–î–æ–¥–∞—Ç–∏ –≥—Ä—É–ø—É</h5>
                            <form action="/admin/dictionaries/add/group" method="POST">
                                <input name="name" class="form-control mb-2" placeholder="–ù–∞–∑–≤–∞ (–ü–ó–ü–Ü-24-6)" required>
                                <input name="student_count" type="number" class="form-control mb-2" placeholder="–ö-—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤" required>
                                <button class="btn btn-primary w-100">–î–æ–¥–∞—Ç–∏</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center py-2">
                                <span class="text-muted fw-bold small">–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:</span>
                                <div class="btn-group btn-group-sm">
                                    <a href="/admin/dictionaries?group_sort=name_asc" 
                                       class="btn btn-outline-secondary <%= query.group_sort=='name_asc'?'active':'' %>">–ê-–Ø</a>
                                    <a href="/admin/dictionaries?group_sort=name_desc" 
                                       class="btn btn-outline-secondary <%= query.group_sort=='name_desc'?'active':'' %>">–Ø-–ê</a>
                                    <a href="/admin/dictionaries?group_sort=students_desc" 
                                       class="btn btn-outline-secondary <%= query.group_sort=='students_desc'?'active':'' %>">–ó–∞ –∫-—Å—Ç—é —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</a>
                                </div>
                            </div>

                            <ul class="list-group list-group-flush">
                                <% groups.forEach(g => { %>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>üéì <strong><%= g.name %></strong> <span class="badge bg-primary rounded-pill ms-2"><%= g.student_count %> —Å—Ç—É–¥.</span></span>
                                        <div>
                                            <button class="btn btn-sm btn-warning" 
                                                onclick="openEditModal('group', '<%= g.id %>', '<%= g.name %>', '<%= g.student_count %>')">‚úèÔ∏è</button>
                                            <form action="/admin/dictionaries/delete/group/<%= g.id %>" method="POST" class="d-inline" onsubmit="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')">
                                                <button class="btn btn-sm btn-danger">üóëÔ∏è</button>
                                            </form>
                                        </div>
                                    </li>
                                <% }) %>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm" method="POST">
                        <input type="hidden" name="id" id="editId">
                        
                        <div id="editFields">
                            </div>

                        <div class="mt-3 text-end">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–í—ñ–¥–º—ñ–Ω–∞</button>
                            <button type="submit" class="btn btn-success">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function openEditModal(type, id, p1, p2, p3) {
            const form = document.getElementById('editForm');
            const fieldsDiv = document.getElementById('editFields');
            const editId = document.getElementById('editId');
            
            form.action = `/admin/dictionaries/edit/${type}`;
            editId.value = id;
            fieldsDiv.innerHTML = '';

            if (type === 'teacher') {
                fieldsDiv.innerHTML = `
                    <label class="form-label">–ü–Ü–ë (–ü–æ–≤–Ω–µ)</label>
                    <input name="full_name" class="form-control mb-2" value="${p1}" required>
                    
                    <label class="form-label">–°–∫–æ—Ä–æ—á–µ–Ω–æ (–¥–ª—è —Ä–æ–∑–∫–ª–∞–¥—É)</label>
                    <input name="short_name" class="form-control" value="${p2}" required>
                `;
            }
            else if (type === 'subject') {
                fieldsDiv.innerHTML = `
                    <label>–ü–æ–≤–Ω–∞ –Ω–∞–∑–≤–∞</label>
                    <input name="full_name" class="form-control mb-2" value="${p1}" required>
                    <label>–°–∫–æ—Ä–æ—á–µ–Ω–æ</label>
                    <input name="short_name" class="form-control" value="${p2}">
                `;
            }
            else if (type === 'classroom') {
                fieldsDiv.innerHTML = `
                    <label>–ù–æ–º–µ—Ä</label>
                    <input name="room_number" class="form-control mb-2" value="${p1}" required>
                    <label>–ö–æ—Ä–ø—É—Å</label>
                    <input name="building" class="form-control mb-2" value="${p2}" required>
                    <label>–ú—ñ—Å—Ü—å</label>
                    <input type="number" name="capacity" class="form-control" value="${p3}" required>
                `;
            }
            else if (type === 'group') {
                fieldsDiv.innerHTML = `
                    <label>–ù–∞–∑–≤–∞</label>
                    <input name="name" class="form-control mb-2" value="${p1}" required>
                    <label>–°—Ç—É–¥–µ–Ω—Ç—ñ–≤</label>
                    <input type="number" name="student_count" class="form-control" value="${p2}" required>
                `;
            }

            const modal = new bootstrap.Modal(document.getElementById('editModal'));
            modal.show();
        }

        document.addEventListener("DOMContentLoaded", function() {
            const urlParams = new URLSearchParams(window.location.search);
            let activeTab = '#teachers';

            if (urlParams.has('room_min') || urlParams.has('room_building') || urlParams.has('room_max')) {
                activeTab = '#classrooms';
            } else if (urlParams.has('group_sort')) {
                activeTab = '#groups';
            } else if (urlParams.has('teacher_search')) {
                activeTab = '#teachers';
            }

            const triggerEl = document.querySelector(`button[data-bs-target="${activeTab}"]`);
            if(triggerEl) {
                const tab = new bootstrap.Tab(triggerEl);
                tab.show();
            }
        });
    </script>
</body>
</html>